<!DOCTYPE html><html lang="ko"><head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.0.2">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">






  

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"ejpark78.github.io","root":"/","scheme":"Gemini","version":"8.0.0-rc.5","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false};
  </script>

  <meta name="description" content="쿠버네티스 에코 시스템 구성  쿠버네티스 클러스터 구성 네트워크 플러그인(calico) 설치 메트릭 서버 플러그인 설치 nvidia 플러그인 설치 StorageClass 설치   선행 작업  parallel 기반 멀티 노드 관리   iptable 설치 1234567sudo apt install -y iptables arptables ebtables# sw">
<meta property="og:type" content="article">
<meta property="og:title" content="쿠버네티스 설치 기록">
<meta property="og:url" content="https://ejpark78.github.io/ckf3rla66000d9e8o8xbt2but.html">
<meta property="og:site_name" content="오늘은 뭘 배우셨나요?">
<meta property="og:description" content="쿠버네티스 에코 시스템 구성  쿠버네티스 클러스터 구성 네트워크 플러그인(calico) 설치 메트릭 서버 플러그인 설치 nvidia 플러그인 설치 StorageClass 설치   선행 작업  parallel 기반 멀티 노드 관리   iptable 설치 1234567sudo apt install -y iptables arptables ebtables# sw">
<meta property="og:locale">
<meta property="article:published_time" content="2020-08-10T05:29:18.000Z">
<meta property="article:modified_time" content="2020-09-15T09:16:24.075Z">
<meta property="article:author" content="Park Eunjin">
<meta property="article:tag" content="쿠버네티스">
<meta property="article:tag" content="설치 기록">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://ejpark78.github.io/ckf3rla66000d9e8o8xbt2but.html">


<script data-pjax="" class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'infra'
  };
</script>

  <title>쿠버네티스 설치 기록 | 오늘은 뭘 배우셨나요?</title>
  






  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript><!-- hexo-inject:begin --><!-- hexo-inject:end -->

<script>function loadCss(l){var d=document,h=d.head,s=d.createElement('link');s.rel='stylesheet';s.href=l;!function e(f){if (d.body)return f();setTimeout(function(){e(f)})}(function(){h.appendChild(s);});}loadCss('/style.css');loadCss('//cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.14.0/css/all.min.css');loadCss('//cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css');</script><noscript><link rel="stylesheet" href="/style.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.14.0/css/all.min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css"></noscript></head>

<body itemscope="" itemtype="http://schema.org/WebPage" class="use-motion">
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="headband"></div>

  <main class="main">
    <header class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">오늘은 뭘 배우셨나요?</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">나도 블로그가 있다!!!</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>홈</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>태그<span class="badge">59</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>카테고리<span class="badge">61</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>아카이브<span class="badge">52</span></a>

  </li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          목차
        </li>
        <li class="sidebar-nav-overview">
          흝어보기
        </li>
      </ul>

      <!--noindex-->
      <section class="post-toc-wrap sidebar-panel">
          <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%EC%BF%A0%EB%B2%84%EB%84%A4%ED%8B%B0%EC%8A%A4-%EC%97%90%EC%BD%94-%EC%8B%9C%EC%8A%A4%ED%85%9C-%EA%B5%AC%EC%84%B1"><span class="nav-number">1.</span> <span class="nav-text"> 쿠버네티스 에코 시스템 구성</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%EC%84%A0%ED%96%89-%EC%9E%91%EC%97%85"><span class="nav-number">2.</span> <span class="nav-text"> 선행 작업</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#iptable-%EC%84%A4%EC%B9%98"><span class="nav-number">3.</span> <span class="nav-text"> iptable 설치</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#docker-%EC%84%A4%EC%B9%98"><span class="nav-number">4.</span> <span class="nav-text"> docker 설치</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#docker-daemonjson-%EC%84%A4%EC%A0%95"><span class="nav-number">5.</span> <span class="nav-text"> docker daemon.json 설정</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#daemonjson-%ED%8C%8C%EC%9D%BC-%EB%B0%B0%ED%8F%AC"><span class="nav-number">6.</span> <span class="nav-text"> daemon.json 파일 배포</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#nvidia-docker%EB%A5%BC-%EC%82%AC%EC%9A%A9%ED%95%98%EB%8A%94-%EA%B2%BD%EC%9A%B0-runtime-%EC%84%A4%EC%A0%95%EC%9D%84-%EB%84%A3%EC%96%B4-%EC%A4%80%EB%8B%A4"><span class="nav-number">7.</span> <span class="nav-text"> nvidia-docker를 사용하는 경우 runtime 설정을 넣어 준다.</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%EC%BF%A0%EB%B2%84%EB%84%A4%ED%8B%B0%EC%8A%A4-cluster-%EC%84%A4%EC%B9%98"><span class="nav-number">8.</span> <span class="nav-text"> 쿠버네티스 cluster 설치</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%EC%82%AC%EC%A0%84-%EC%84%A4%EC%B9%98"><span class="nav-number">8.1.</span> <span class="nav-text"> 사전 설치</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EC%BF%A0%EB%B2%84%EB%84%A4%ED%8B%B0%EC%8A%A4-%ED%8C%A8%ED%82%A4%EC%A7%80-%EC%A0%95%EB%B3%B4-%ED%99%95%EC%9D%B8"><span class="nav-number">8.2.</span> <span class="nav-text"> 쿠버네티스 패키지 정보 확인</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EC%BF%A0%EB%B2%84%EB%84%A4%ED%8B%B0%EC%8A%A4-%EC%84%A4%EC%B9%98"><span class="nav-number">8.3.</span> <span class="nav-text"> 쿠버네티스 설치</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%EC%BF%A0%EB%B2%84%EB%84%A4%ED%8B%B0%EC%8A%A4-cluster-%EC%B4%88%EA%B8%B0%ED%99%94"><span class="nav-number">9.</span> <span class="nav-text"> 쿠버네티스 cluster 초기화</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%EC%BF%A0%EB%B2%84%EB%84%A4%ED%8B%B0%EC%8A%A4-%EB%A7%88%EC%8A%A4%ED%84%B0-%EB%85%B8%EB%93%9C-%EC%8A%A4%EC%BC%80%EC%A5%B4%EB%A7%81"><span class="nav-number">10.</span> <span class="nav-text"> 쿠버네티스 마스터 노드 스케쥴링</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#kubeconfig-%EB%8B%A4%EC%9A%B4%EB%A1%9C%EB%93%9C"><span class="nav-number">11.</span> <span class="nav-text"> kubeconfig 다운로드</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%EC%BF%A0%EB%B2%84%EB%84%A4%ED%8B%B0%EC%8A%A4-%EB%84%A4%ED%8A%B8%EC%9B%8C%ED%81%AC-%EC%84%A4%EC%B9%98"><span class="nav-number">12.</span> <span class="nav-text"> 쿠버네티스 네트워크 설치</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%EB%A9%94%ED%8A%B8%EB%A6%AD-%EC%84%9C%EB%B2%84-%EC%84%A4%EC%B9%98"><span class="nav-number">13.</span> <span class="nav-text"> 메트릭 서버 설치</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%EB%A9%94%ED%8A%B8%EB%A6%AD-%EC%84%9C%EB%B2%84-%EC%8B%A4%ED%96%89"><span class="nav-number">13.1.</span> <span class="nav-text"> 메트릭 서버 실행</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#nvidia-plugin-%EC%84%A4%EC%B9%98"><span class="nav-number">14.</span> <span class="nav-text"> nvidia plugin 설치</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#gpu-%ED%85%8C%EC%8A%A4%ED%8A%B8-%ED%95%98%EA%B8%B0"><span class="nav-number">14.1.</span> <span class="nav-text"> GPU 테스트 하기</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#python-gpu-%ED%85%8C%EC%8A%A4%ED%8A%B8"><span class="nav-number">14.2.</span> <span class="nav-text"> python GPU 테스트</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%ED%8C%8C%EB%93%9C-%EC%82%AD%EC%A0%9C"><span class="nav-number">14.3.</span> <span class="nav-text"> 파드 삭제</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%EB%85%B8%EB%93%9C-%ED%99%95%EC%9E%A5"><span class="nav-number">15.</span> <span class="nav-text"> 노드 확장</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%EB%85%B8%EB%93%9C-%EC%B6%95%EC%86%8C"><span class="nav-number">16.</span> <span class="nav-text"> 노드 축소</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%EB%B2%84%EC%A0%84-%EC%97%85%EA%B7%B8%EB%A0%88%EC%9D%B4%EB%93%9C"><span class="nav-number">17.</span> <span class="nav-text"> 버전 업그레이드</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%EC%B0%B8%EA%B3%A0"><span class="nav-number">18.</span> <span class="nav-text"> 참고</span></a></li></ol></div>
      </section>
      <!--/noindex-->

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-author animated" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Park Eunjin</p>
  <div class="site-description" itemprop="description">적자생존!</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">52</span>
          <span class="site-state-item-name">포스트</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">61</span>
        <span class="site-state-item-name">카테고리</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">59</span>
        <span class="site-state-item-name">태그</span></a>
      </div>
  </nav>
</div>



      </section>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">
      

      

    
  
  
  <article itemscope="" itemtype="http://schema.org/Article" class="post-block" lang="infra">
    <link itemprop="mainEntityOfPage" href="https://ejpark78.github.io/ckf3rla66000d9e8o8xbt2but.html">

    <span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Park Eunjin">
      <meta itemprop="description" content="적자생존!">
    </span>

    <span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="오늘은 뭘 배우셨나요?">
    </span>

    
    
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          쿠버네티스 설치 기록
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">작성일</span>

              <time title="Post created: 2020-08-10 14:29:18" itemprop="dateCreated datePublished" datetime="2020-08-10T14:29:18+09:00">2020-08-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Updated at: 2020-09-15 18:16:24" itemprop="dateModified" datetime="2020-09-15T18:16:24+09:00">2020-09-15</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/%EC%84%A4%EC%B9%98-%EA%B8%B0%EB%A1%9D/" itemprop="url" rel="index"><span itemprop="name">설치 기록</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/%EC%84%A4%EC%B9%98-%EA%B8%B0%EB%A1%9D/%EC%BF%A0%EB%B2%84%EB%84%A4%ED%8B%B0%EC%8A%A4/" itemprop="url" rel="index"><span itemprop="name">쿠버네티스</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h2 id="쿠버네티스-에코-시스템-구성"><a class="markdownIt-Anchor" href="#쿠버네티스-에코-시스템-구성"></a> 쿠버네티스 에코 시스템 구성</h2>
<ul>
<li>쿠버네티스 클러스터 구성</li>
<li>네트워크 플러그인(calico) 설치</li>
<li>메트릭 서버 플러그인 설치</li>
<li>nvidia 플러그인 설치</li>
<li>StorageClass 설치</li>
</ul>
<h2 id="선행-작업"><a class="markdownIt-Anchor" href="#선행-작업"></a> 선행 작업</h2>
<ul>
<li><a href="/ckdp8y0gb000cojflftba54dc.html">parallel 기반 멀티 노드 관리</a></li>
</ul>
<h2 id="iptable-설치"><a class="markdownIt-Anchor" href="#iptable-설치"></a> iptable 설치</h2>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install -y iptables arptables ebtables</span><br><span class="line"></span><br><span class="line"><span class="comment"># switch to legacy versions</span></span><br><span class="line">sudo update-alternatives --<span class="built_in">set</span> iptables /usr/sbin/iptables-legacy</span><br><span class="line">sudo update-alternatives --<span class="built_in">set</span> ip6tables /usr/sbin/ip6tables-legacy</span><br><span class="line">sudo update-alternatives --<span class="built_in">set</span> arptables /usr/sbin/arptables-legacy</span><br><span class="line">sudo update-alternatives --<span class="built_in">set</span> ebtables /usr/sbin/ebtables-legacy</span><br></pre></td></tr></tbody></table></figure>
<h2 id="docker-설치"><a class="markdownIt-Anchor" href="#docker-설치"></a> docker 설치</h2>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cls-p cloud <span class="string">"sudo apt install -yq apt-transport-https ca-certificates curl gnupg-agent software-properties-common"</span></span><br><span class="line">cls-p cloud <span class="string">"sudo apt install -yq docker.io"</span></span><br><span class="line"></span><br><span class="line">cls-p cloud <span class="string">"sudo usermod -aG docker \$USER"</span></span><br><span class="line"></span><br><span class="line">cls-p cloud <span class="string">"sudo systemctl start docker"</span></span><br><span class="line">cls-p cloud <span class="string">"sudo systemctl enable docker"</span></span><br><span class="line"></span><br><span class="line">cls-p cloud <span class="string">"docker version"</span></span><br></pre></td></tr></tbody></table></figure>
<h2 id="docker-daemonjson-설정"><a class="markdownIt-Anchor" href="#docker-daemonjson-설정"></a> docker daemon.json 설정</h2>
<ul>
<li>docker daemon 파일 생성</li>
</ul>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">DOCKER_RESITRY=registry:5000</span></span><br><span class="line"></span><br><span class="line"><span class="string">cat</span> <span class="string">&lt;&lt;EOF</span> <span class="string">|</span> <span class="string">tee</span> <span class="string">daemon.json</span></span><br><span class="line">{</span><br><span class="line">  <span class="attr">"bip":</span> <span class="string">"10.0.0.1/16"</span>,</span><br><span class="line">  <span class="attr">"exec-opts":</span> [</span><br><span class="line">    <span class="string">"native.cgroupdriver=systemd"</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"log-driver":</span> <span class="string">"json-file"</span>,</span><br><span class="line">  <span class="attr">"log-opts":</span> {</span><br><span class="line">    <span class="attr">"max-size":</span> <span class="string">"100m"</span></span><br><span class="line">  },</span><br><span class="line">  <span class="attr">"storage-driver":</span> <span class="string">"overlay2"</span>,</span><br><span class="line">  <span class="attr">"dns":</span> [</span><br><span class="line">    <span class="string">"8.8.8.8"</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"hosts":</span> [</span><br><span class="line">    <span class="string">"fd://"</span>,</span><br><span class="line">    <span class="string">"unix:///var/run/docker.sock"</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"insecure-registries":</span> [</span><br><span class="line">    <span class="string">"${DOCKER_RESITRY}"</span></span><br><span class="line">  ]</span><br><span class="line">}</span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="string">cat</span> <span class="string">cloud</span> <span class="string">|</span> <span class="string">xargs</span> <span class="string">-I{}</span> <span class="string">scp</span> <span class="string">daemon.json</span> {}<span class="string">:</span></span><br></pre></td></tr></tbody></table></figure>
<h2 id="daemonjson-파일-배포"><a class="markdownIt-Anchor" href="#daemonjson-파일-배포"></a> daemon.json 파일 배포</h2>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">cat &lt;&lt;EOF | tee batch.sh</span><br><span class="line">sudo sed -i.back <span class="string">'s#dockerd -H fd:// #dockerd #'</span> /lib/systemd/system/docker.service</span><br><span class="line">sudo mv daemon.json /etc/docker/daemon.json</span><br><span class="line"></span><br><span class="line">grep dockerd /lib/systemd/system/docker.service</span><br><span class="line"></span><br><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl restart docker</span><br><span class="line"></span><br><span class="line">route | grep docker0</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">cat cloud | xargs -I{} scp batch.sh {}:</span><br><span class="line"></span><br><span class="line">cls-p cloud <span class="string">"sh batch.sh &amp;&amp; rm batch.sh"</span></span><br></pre></td></tr></tbody></table></figure>
<h2 id="nvidia-docker를-사용하는-경우-runtime-설정을-넣어-준다"><a class="markdownIt-Anchor" href="#nvidia-docker를-사용하는-경우-runtime-설정을-넣어-준다"></a> nvidia-docker를 사용하는 경우 runtime 설정을 넣어 준다.</h2>
<ul>
<li>docker 19.03.8 부터는 데몬에 “/usr/bin/dockerd … --add-runtime=nvidia=/usr/bin/nvidia-container-runtime” 이렇게 붙어 있다.</li>
</ul>
<figure class="highlight json"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">{</span><br><span class="line">  <span class="attr">"bip"</span>: <span class="string">"10.0.0.1/16"</span>,</span><br><span class="line">  <span class="attr">"exec-opts"</span>: [</span><br><span class="line">    <span class="string">"native.cgroupdriver=systemd"</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"log-driver"</span>: <span class="string">"json-file"</span>,</span><br><span class="line">  <span class="attr">"log-opts"</span>: {</span><br><span class="line">    <span class="attr">"max-size"</span>: <span class="string">"100m"</span></span><br><span class="line">  },</span><br><span class="line">  <span class="attr">"storage-driver"</span>: <span class="string">"overlay2"</span>,</span><br><span class="line">  <span class="attr">"dns"</span>: [</span><br><span class="line">    <span class="string">"8.8.8.8"</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"hosts"</span>: [</span><br><span class="line">    <span class="string">"fd://"</span>,</span><br><span class="line">    <span class="string">"unix:///var/run/docker.sock"</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"insecure-registries"</span>: [</span><br><span class="line">    <span class="string">"registry:5000"</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"default-runtime"</span>: <span class="string">"nvidia"</span>,</span><br><span class="line">  <span class="attr">"runtimes"</span>: {</span><br><span class="line">    <span class="attr">"nvidia"</span>: {</span><br><span class="line">      <span class="attr">"path"</span>: <span class="string">"/usr/bin/nvidia-container-runtime"</span>,</span><br><span class="line">      <span class="attr">"runtimeArgs"</span>: []</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h2 id="쿠버네티스-cluster-설치"><a class="markdownIt-Anchor" href="#쿠버네티스-cluster-설치"></a> 쿠버네티스 cluster 설치</h2>
<ul>
<li><a target="_blank" rel="noopener" href="https://vitux.com/install-and-deploy-kubernetes-on-ubuntu/">install-and-deploy-kubernetes-on-ubuntu</a></li>
<li><a target="_blank" rel="noopener" href="https://www.linuxtechi.com/install-configure-kubernetes-ubuntu-18-04-ubuntu-18-10/">install-configure-kubernetes-ubuntu-18-04-ubuntu-18-10</a></li>
<li><a target="_blank" rel="noopener" href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/install-kubeadm/">install-kubeadm</a></li>
<li><a target="_blank" rel="noopener" href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/create-cluster-kubeadm/">create-cluster-kubeadm</a></li>
</ul>
<h3 id="사전-설치"><a class="markdownIt-Anchor" href="#사전-설치"></a> 사전 설치</h3>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">cat &lt;&lt;EOF | tee kubernetes.list</span><br><span class="line">deb https://apt.kubernetes.io/ kubernetes-xenial main</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">cat &lt;&lt;EOF | tee k8s.conf</span><br><span class="line">net.bridge.bridge-nf-call-ip6tables = 1</span><br><span class="line">net.bridge.bridge-nf-call-iptables = 1</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">cat &lt;&lt;EOF | tee apt-setup.sh</span><br><span class="line">sudo mv k8s.conf /etc/sysctl.d/k8s.conf</span><br><span class="line"></span><br><span class="line">curl -s https://packages.cloud.google.com/apt/doc/apt-key.gpg | sudo apt-key add -</span><br><span class="line">sudo mv kubernetes.list /etc/apt/sources.list.d/kubernetes.list</span><br><span class="line"></span><br><span class="line">sudo swapoff -a</span><br><span class="line">sudo sysctl --system</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">cat cloud | xargs -I{} scp k8s.conf {}:</span><br><span class="line">cat cloud | xargs -I{} scp kubernetes.list {}:</span><br><span class="line">cat cloud | xargs -I{} scp apt-setup.sh {}:</span><br><span class="line"></span><br><span class="line">cls-p cloud <span class="string">"sh apt-setup.sh &amp;&amp; rm apt-setup.sh"</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="쿠버네티스-패키지-정보-확인"><a class="markdownIt-Anchor" href="#쿠버네티스-패키지-정보-확인"></a> 쿠버네티스 패키지 정보 확인</h3>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">❯ apt-cache madison kubeadm | head -n 3</span><br><span class="line">   kubeadm |  1.19.0-00 | https://apt.kubernetes.io kubernetes-xenial/main amd64 Packages</span><br><span class="line">   kubeadm |  1.18.8-00 | https://apt.kubernetes.io kubernetes-xenial/main amd64 Packages</span><br><span class="line">   kubeadm |  1.18.6-00 | https://apt.kubernetes.io kubernetes-xenial/main amd64 Packages</span><br><span class="line">   kubeadm |  1.18.5-00 | https://apt.kubernetes.io kubernetes-xenial/main amd64 Packages</span><br><span class="line">   kubeadm |  1.18.4-01 | https://apt.kubernetes.io kubernetes-xenial/main amd64 Packages</span><br><span class="line"> </span><br><span class="line">❯ apt-cache policy kubeadm | head -n 6</span><br><span class="line">kubeadm:</span><br><span class="line">  Installed: 1.18.5-00</span><br><span class="line">  Candidate: 1.19.0-00</span><br><span class="line">  Version table:</span><br><span class="line">     1.19.0-00 500</span><br><span class="line">        500 https://apt.kubernetes.io kubernetes-xenial/main amd64 Packages</span><br><span class="line">     1.18.8-00 500</span><br><span class="line">        500 https://apt.kubernetes.io kubernetes-xenial/main amd64 Packages</span><br><span class="line">     1.18.6-00 500</span><br><span class="line">        500 https://apt.kubernetes.io kubernetes-xenial/main amd64 Packages</span><br></pre></td></tr></tbody></table></figure>
<h3 id="쿠버네티스-설치"><a class="markdownIt-Anchor" href="#쿠버네티스-설치"></a> 쿠버네티스 설치</h3>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">cat &lt;&lt;EOF | tee batch.sh</span><br><span class="line">sudo apt update -yq</span><br><span class="line"></span><br><span class="line">apt-cache madison kubeadm | head -n 3</span><br><span class="line"></span><br><span class="line">apt-cache policy kubeadm | head -n 6</span><br><span class="line"></span><br><span class="line">sudo apt install -y apt-transport-https curl</span><br><span class="line">sudo apt install -y kubelet kubeadm kubectl</span><br><span class="line"></span><br><span class="line">sudo apt-mark hold docker kubelet kubeadm kubectl</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">cat cloud | xargs -I{} scp batch.sh {}:</span><br><span class="line"></span><br><span class="line">cls-p cloud <span class="string">"sh batch.sh &amp;&amp; rm batch.sh"</span></span><br></pre></td></tr></tbody></table></figure>
<h2 id="쿠버네티스-cluster-초기화"><a class="markdownIt-Anchor" href="#쿠버네티스-cluster-초기화"></a> 쿠버네티스 cluster 초기화</h2>
<p>외부 DNS나 IP로 접근을 원할 경우 ‘–apiserver-cert-extra-sans’ 옵션을 사용한다.</p>
<blockquote>
<p>–apiserver-cert-extra-sans는 추가적으로 인증에 사용할 IP 주소. 외부에서 쿠버네티스 클러스터에 접근할 수 있는 편이 관리 측면에서 월등하게 편리하니, master의 퍼블릭 IP를 기입한다.</p>
</blockquote>
<ul>
<li>참고
<ul>
<li><a target="_blank" rel="noopener" href="https://blog.dudaji.com/kubernetes/2020/04/08/add-ip-to-kube-api-cert.html">GCE에 설치한 쿠버네티스 클러스터를 내 로컬 kubectl에서</a></li>
<li><a target="_blank" rel="noopener" href="https://kycfeel.github.io/2018/10/14/%EC%8A%A4%EC%8A%A4%EB%A1%9C-Kubernetes-%ED%81%B4%EB%9F%AC%EC%8A%A4%ED%84%B0-%EA%B5%AC%EC%B6%95%ED%95%98%EA%B8%B0/">스스로 Kubernetes 클러스터 구축하기</a></li>
</ul>
</li>
</ul>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">K8S_MASTER_IP=10.10.0.2</span><br><span class="line"></span><br><span class="line">POD_CIDR=10.1.0.0/16 </span><br><span class="line">SERVICE_CIDR=10.2.0.0/16</span><br><span class="line"></span><br><span class="line">K8S_EXTRA_SANS=<span class="string">'--apiserver-cert-extra-sans my-dns.com,my-dns2.com'</span></span><br><span class="line"></span><br><span class="line">cls cloud-m <span class="string">"sudo kubeadm init --pod-network-cidr=<span class="variable">${POD_CIDR}</span> --service-cidr <span class="variable">${SERVICE_CIDR}</span> <span class="variable">${K8S_EXTRA_SANS}</span>"</span></span><br><span class="line"></span><br><span class="line">cat &lt;&lt;EOF | tee batch.sh</span><br><span class="line">mkdir -p \<span class="variable">$HOME</span>/.kube</span><br><span class="line">sudo cp -i /etc/kubernetes/admin.conf \<span class="variable">$HOME</span>/.kube/config</span><br><span class="line">sudo chown $(id -u):$(id -g) \<span class="variable">$HOME</span>/.kube/config</span><br><span class="line"></span><br><span class="line">sudo chown \<span class="variable">$UID</span> \<span class="variable">$HOME</span>/.kube/config</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">cat cloud-m | xargs -I{} scp batch.sh {}:</span><br><span class="line"></span><br><span class="line">cls-p cloud-m <span class="string">"sh batch.sh &amp;&amp; rm batch.sh"</span></span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cls cloud-w <span class="string">"sudo kubeadm join <span class="variable">${K8S_MASTER_IP}</span>:6443 --token ***** --discovery-token-ca-cert-hash *****"</span></span><br><span class="line"></span><br><span class="line">cls-p cloud-m <span class="string">"kubectl get nodes -o wide"</span></span><br><span class="line"></span><br><span class="line">cls cloud-m <span class="string">"cat .kube/config"</span></span><br></pre></td></tr></tbody></table></figure>
<h2 id="쿠버네티스-마스터-노드-스케쥴링"><a class="markdownIt-Anchor" href="#쿠버네티스-마스터-노드-스케쥴링"></a> 쿠버네티스 마스터 노드 스케쥴링</h2>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cls-p cloud-m <span class="string">"kubectl taint nodes --all node-role.kubernetes.io/master-"</span></span><br></pre></td></tr></tbody></table></figure>
<h2 id="kubeconfig-다운로드"><a class="markdownIt-Anchor" href="#kubeconfig-다운로드"></a> kubeconfig 다운로드</h2>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cat cloud-m | xargs -I{} scp {}:.kube/config kubeconfig.{}</span><br><span class="line"></span><br><span class="line">cat cloud-m | xargs -I{} kubectl --kubeconfig kubeconfig.{} get nodes -o wide</span><br><span class="line"></span><br><span class="line"><span class="comment"># ~/.kube/config 에 병합</span></span><br></pre></td></tr></tbody></table></figure>
<h2 id="쿠버네티스-네트워크-설치"><a class="markdownIt-Anchor" href="#쿠버네티스-네트워크-설치"></a> 쿠버네티스 네트워크 설치</h2>
<ul>
<li>calico 의 디폴트 IP 범위(192.168.0.0/16) 를 10.1.0.0/16 (kubeadm의 pod-network-cidr) 으로 변경</li>
<li>calico-node daemon set에서 <a target="_blank" rel="noopener" href="http://beta.kubernetes.io/os=linux">beta.kubernetes.io/os=linux</a> 레이블을 사용함</li>
</ul>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#curl -LO https://docs.projectcalico.org/v3.9/manifests/calico.yaml</span></span><br><span class="line">curl https://docs.projectcalico.org/manifests/calico.yaml -O</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.16 에서는 주석처리 되어 있다.</span></span><br><span class="line"><span class="comment">#sed -i -e "s#192.168.0.0/16#10.1.0.0/16#g" calico.yaml</span></span><br><span class="line"></span><br><span class="line">cat cloud-m | xargs -I{} scp calico.yaml {}:</span><br><span class="line"></span><br><span class="line">cls cloud-m <span class="string">"kubectl apply -f calico.yaml"</span></span><br></pre></td></tr></tbody></table></figure>
<h2 id="메트릭-서버-설치"><a class="markdownIt-Anchor" href="#메트릭-서버-설치"></a> 메트릭 서버 설치</h2>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/kubernetes-sigs/metrics-server">metrics server</a></li>
</ul>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -LO https://github.com/kubernetes-sigs/metrics-server/releases/download/v0.3.7/components.yaml </span><br></pre></td></tr></tbody></table></figure>
<ul>
<li>
<p>이슈: 아래와 같이 args 를 수정한다.</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/kubernetes-sigs/metrics-server/issues/300">kubectl top pods result in error #300</a></li>
</ul>
</li>
<li>
<p>args: 에 두줄을 추가한다.</p>
<ul>
<li>–kubelet-insecure-tls=true</li>
<li>–kubelet-preferred-address-types=InternalIP</li>
</ul>
</li>
</ul>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">metrics-server</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">k8s.gcr.io/metrics-server/metrics-server:v0.3.7</span></span><br><span class="line">        <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">        <span class="attr">args:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">--cert-dir=/tmp</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">--secure-port=4443</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">--kubelet-insecure-tls=true</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">--kubelet-preferred-address-types=InternalIP</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="메트릭-서버-실행"><a class="markdownIt-Anchor" href="#메트릭-서버-실행"></a> 메트릭 서버 실행</h3>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cat cloud-m | xargs -I{} scp components.yaml {}:</span><br><span class="line"></span><br><span class="line">cls-p cloud-m <span class="string">"kubectl apply -f components.yaml"</span></span><br><span class="line"></span><br><span class="line">cls cloud-m <span class="string">"kubectl top nodes"</span></span><br></pre></td></tr></tbody></table></figure>
<h2 id="nvidia-plugin-설치"><a class="markdownIt-Anchor" href="#nvidia-plugin-설치"></a> nvidia plugin 설치</h2>
<ul>
<li>nvidia-docker 설치 후 플러그인 설치
<ul>
<li><a target="_blank" rel="noopener" href="https://kubernetes.io/docs/tasks/manage-gpus/scheduling-gpus/">scheduling-gpus</a></li>
</ul>
</li>
</ul>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply \</span><br><span class="line">    -f https://raw.githubusercontent.com/NVIDIA/k8s-device-plugin/1.0.0-beta4/nvidia-device-plugin.yml</span><br></pre></td></tr></tbody></table></figure>
<h3 id="gpu-테스트-하기"><a class="markdownIt-Anchor" href="#gpu-테스트-하기"></a> GPU 테스트 하기</h3>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">cat &lt;&lt;EOF | kubectl apply -f -</span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  labels:</span><br><span class="line">    app: tf-gpu-jupyter</span><br><span class="line">  name: tf-gpu-jupyter</span><br><span class="line">  namespace: default</span><br><span class="line">spec:</span><br><span class="line">  replicas: 1</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: tf-gpu-jupyter</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: tf-gpu-jupyter</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - image: tensorflow/tensorflow:2.1.0-gpu-py3-jupyter</span><br><span class="line">        imagePullPolicy: IfNotPresent</span><br><span class="line">        name: tf-gpu-jupyter</span><br><span class="line">        ports:</span><br><span class="line">        - containerPort: 8888</span><br><span class="line">          protocol: TCP</span><br><span class="line">        resources:</span><br><span class="line">          limits:</span><br><span class="line">            nvidia.com/gpu: <span class="string">"1"</span></span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">kubectl get pod -l app=tf-gpu-jupyter</span><br><span class="line"></span><br><span class="line">kubectl logs -l app=tf-gpu-jupyter</span><br><span class="line"></span><br><span class="line">kubectl port-forward pod/tf-gpu-jupyter-69b7644cc6-h9n44 8888:8888</span><br></pre></td></tr></tbody></table></figure>
<h3 id="python-gpu-테스트"><a class="markdownIt-Anchor" href="#python-gpu-테스트"></a> python GPU 테스트</h3>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> absolute_import, division, print_function, unicode_literals</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line">print(<span class="string">"Num GPUs Available: "</span>, len(tf.config.experimental.list_physical_devices(<span class="string">'GPU'</span>)))</span><br></pre></td></tr></tbody></table></figure>
<h3 id="파드-삭제"><a class="markdownIt-Anchor" href="#파드-삭제"></a> 파드 삭제</h3>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl delete deploy tf-gpu-jupyter</span><br></pre></td></tr></tbody></table></figure>
<h2 id="노드-확장"><a class="markdownIt-Anchor" href="#노드-확장"></a> 노드 확장</h2>
<ul>
<li>참고: <a target="_blank" rel="noopener" href="https://kubernetes.io/ko/docs/tasks/administer-cluster/kubeadm/adding-windows-nodes/">노드 추가</a></li>
</ul>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">❯ sudo kubeadm token list</span><br><span class="line"></span><br><span class="line">❯ sudo kubeadm token create --<span class="built_in">print</span>-join-command</span><br><span class="line">kubeadm join MASTER_IP:6443 --token ****  --discovery-token-ca-cert-hash ****</span><br><span class="line"></span><br><span class="line">❯ sudo kubeadm upgrade node</span><br></pre></td></tr></tbody></table></figure>
<h2 id="노드-축소"><a class="markdownIt-Anchor" href="#노드-축소"></a> 노드 축소</h2>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">kubectl drain &lt;node name&gt;</span><br><span class="line"></span><br><span class="line">kubectl uncordon &lt;node name&gt;</span><br><span class="line"></span><br><span class="line">kubectl delete node &lt;node name&gt;</span><br></pre></td></tr></tbody></table></figure>
<h2 id="버전-업그레이드"><a class="markdownIt-Anchor" href="#버전-업그레이드"></a> 버전 업그레이드</h2>
<ul>
<li>참고: <a target="_blank" rel="noopener" href="https://kubernetes.io/ko/docs/tasks/administer-cluster/kubeadm/kubeadm-upgrade/">kubeadm-upgrade</a></li>
</ul>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">cls-p cloud-m <span class="string">"sudo apt update &amp;&amp; sudo apt-cache madison kubeadm"</span></span><br><span class="line"></span><br><span class="line">cls-p cloud-m <span class="string">"sudo apt update &amp;&amp; sudo apt install -y --allow-change-held-packages kubeadm"</span></span><br><span class="line"></span><br><span class="line">kubeadm version</span><br><span class="line"></span><br><span class="line">cls cloud-m <span class="string">"sudo kubeadm upgrade plan"</span></span><br><span class="line"></span><br><span class="line">cls cloud-m <span class="string">"sudo kubeadm upgrade apply -y v1.19.0"</span></span><br><span class="line"></span><br><span class="line">cls cloud-m <span class="string">"kubectl get nodes -o wide"</span></span><br><span class="line"></span><br><span class="line">cls cloud-m <span class="string">"sudo kubeadm upgrade node"</span></span><br><span class="line"></span><br><span class="line">cls-p cloud <span class="string">"sudo apt update &amp;&amp; sudo apt install -y --allow-change-held-packages kubelet kubectl"</span></span><br><span class="line"></span><br><span class="line">cls cloud-m <span class="string">"sudo kubeadm upgrade node"</span></span><br><span class="line"></span><br><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl restart kubelet</span><br></pre></td></tr></tbody></table></figure>
<h2 id="참고"><a class="markdownIt-Anchor" href="#참고"></a> 참고</h2>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.kangwoo.kr/2020/02/17/pc%EC%97%90-kubeflow-%EC%84%A4%EC%B9%98%ED%95%98%EA%B8%B0-2%EB%B6%80-kubernetes-nvidia-device-plugin-%EC%84%A4%EC%B9%98%ED%95%98%EA%B8%B0/">pc에-kubeflow-설치하기-2부-kubernetes-nvidia-device-plugin-설치하기, 지구별 여행자</a></li>
</ul>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%EC%BF%A0%EB%B2%84%EB%84%A4%ED%8B%B0%EC%8A%A4/" rel="tag"># 쿠버네티스</a>
              <a href="/tags/%EC%84%A4%EC%B9%98-%EA%B8%B0%EB%A1%9D/" rel="tag"># 설치 기록</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/ckf3rla7t00229e8ob33qhipv.html" rel="prev" title="git config 설정">
                  <i class="fa fa-chevron-left"></i> git config 설정
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/ckf3rlab400ac9e8odtncebtp.html" rel="next" title="한국어 데이터셋">
                  한국어 데이터셋 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
      </footer>
    
  </article>
  
  
  



      

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

    </div>
  </main>

  <footer class="footer">
    <div class="footer-inner">
      

      

<div class="copyright">
  
  © 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Park Eunjin</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> &amp; <a href="https://theme-next.js.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

      








    </div>
  </footer>

  
  <script src="//cdn.jsdelivr.net/npm/animejs@3.2.0/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/@next-theme/pjax@0.4.0/pjax.min.js"></script>

  


  















    <div class="pjax">
  

  

  

    </div><!-- hexo-inject:begin --><!-- hexo-inject:end -->


<script src="/bundle.js"></script><script>
var pjax = new Pjax({
  selectors: [
    'head title',
    '.page-configurations',
    '.main-inner',
    '.post-toc-wrap',
    '.languages',
    '.pjax'
  ],
  analytics: false,
  cacheBust: false,
  scrollRestoration: false,
  scrollTo: !CONFIG.bookmark.enable
});

document.addEventListener('pjax:success', () => {
  pjax.executeScripts(document.querySelectorAll('script[data-pjax], .pjax script'));
  NexT.boot.refresh();
  // Define Motion Sequence & Bootstrap Motion.
  if (CONFIG.motion.enable) {
    NexT.motion.integrator
      .init()
      .add(NexT.motion.middleWares.subMenu)
      .add(NexT.motion.middleWares.postList)
      .bootstrap();
  }
  const hasTOC = document.querySelector('.post-toc');
  document.querySelector('.sidebar-inner').classList.toggle('sidebar-nav-active', hasTOC);
  document.querySelector(hasTOC ? '.sidebar-nav-toc' : '.sidebar-nav-overview').click();
  NexT.utils.updateSidebarPosition();
});
</script></body></html>